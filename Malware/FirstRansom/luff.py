#!/usr/bin/env python3

# decrypt stuff
import os
from cryptography.fernet import Fernet

# file types to hit
exts = ['.txt','.docx','.pdf','.png','.jpg','.xlsx','.csv']
skip = ['ransom_sloppy.py','README_DECRYPT.txt','decrypt_sloppy.py']

# get key
key = input("Paste the key you got when stuff got locked:\n").strip()
try:
	f = Fernet(key.encode())
except:
	print("bad key. bye.")
	exit()

# find files
files = []
for root, dirs, filenames in os.walk("."):
	for name in filenames:
		if name in skip:
			continue
		if any(name.lower().endswith(x) for x in exts):
			files.append(os.path.join(root, name))

print("decrypting", len(files), "files...")

# decrypt loop
for file in files:
	try:
		with open(file, 'rb') as r:
			data = r.read()
		data = f.decrypt(data)
		with open(file, 'wb') as w:
			w.write(data)
		print("unlocked", file)
	except:
		print("couldn't unlock", file)

print("done.")
